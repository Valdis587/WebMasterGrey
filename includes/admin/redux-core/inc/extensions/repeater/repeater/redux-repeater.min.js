!function(l){"use strict";var u,p;redux.field_objects=redux.field_objects||{},redux.field_objects.repeater=redux.field_objects.repeater||{},redux.field_objects.repeater.getOptName=function(e){var r=e.parents().find(".redux-ajax-security").data("opt-name");return void 0===(r=void 0===r?e.parents(".redux-container").data("opt-name"):r)?redux:redux.optName},redux.field_objects.repeater.init=function(e){e=e||l(document).find(".redux-group-tab:visible").find(".redux-container-repeater:visible"),l(e).each(function(){var e,r,t=l(this),a=t;(a=t.hasClass("redux-field-container")?a:t.parents(".redux-field-container:first")).is(":hidden")||a.hasClass("redux-field-init")&&(a.removeClass("redux-field-init"),t.hasClass("redux-field-container")||(a=t.parents(".redux-field-container:first")),u=redux.field_objects.repeater.getOptName(t),e=a.attr("data-id"),r=t.find(".redux-repeater-accordion-repeater:last-child"),u.repeater[e].blank=r.clone().wrap("<p>").parent().html(),a.hasClass("redux-container-repeater")&&a.addClass("redux-field-init"),a.hasClass("redux-field-init"))&&(a.removeClass("redux-field-init"),redux.field_objects.repeater.setAccordion(t,e),redux.field_objects.repeater.bindTitle(t),redux.field_objects.repeater.remove(t,e),redux.field_objects.repeater.add(t))})},redux.field_objects.repeater.add=function(c){String.prototype.reduxReplaceAll=function(e,r){return this.replace(new RegExp(e.replace(/[.^$*+?()[{|]/g,"\\$&"),"g"),r)},c.find(".redux-repeaters-add").on("click",function(){var e,r,t,a,i,d,n,s,o;redux_change(l(this)),l(this).hasClass("button-disabled")||(s=(n=l(this).parent().find(".redux-repeater-accordion:first")).find(".redux-repeater-accordion-repeater").length,o=n.attr("data-id"),""!==u.repeater[o].limit&&s>=u.repeater[o].limit?l(this).addClass("button-disabled"):(s+=1,e=n.find(".redux-repeater-accordion-repeater").length,n.find(".redux-repeater-accordion-repeater:last").find(".ui-accordion-header").hasClass("ui-state-active")&&n.find(".redux-repeater-accordion-repeater:last").find(".ui-accordion-header").trigger("click"),0===(r=n.find(".redux-repeater-accordion-repeater:last").clone(!0,!0)).length&&(r=u.repeater[o].blank),u.repeater[o]&&(u.repeater[o].count=c.find(".redux-repeater-header").length,t=u.repeater[o].html.reduxReplaceAll("99999",e),l(r).find(".redux-repeater-header").text("")),r.find(".ui-accordion-content").html(t),a=[],r.find(".redux-container-editor")&&(i=l(".redux-repeater-accordion-repeater:first").find(".redux-container-editor").attr("data-id"),d=window.tinyMCEPreInit.mceInit[i],l.each(r.find(".redux-container-editor"),function(){a.push(l(this).attr("data-id")),QTags.getInstance(i).settings.id=a[a.length-1]})),l(n).append(r),r.find(".redux-container-editor")&&l.each(a,function(e,r){tinymce.createEditor(r,d).render(),quicktags(r),QTags._buttonsInit()}),redux.field_objects.repeater.sort_repeaters(r),(r=l(this).parent().find(".redux-repeater-accordion:first")).find(".redux-repeater-accordion-repeater:last .ui-accordion-header").trigger("click"),r.find(".redux-repeater-accordion-repeater:last .bind_title").on("change keyup",function(e){e=0<l(e.target).find(":selected").text().length?l(e.target).find(":selected").text():l(e.target).val();l(this).closest(".redux-repeater-accordion-repeater").find(".redux-repeater-header").text(e)}),l.redux.checkRequired(c),0<u.repeater[o].limit&&s>=u.repeater[o].limit&&l(this).addClass("button-disabled"),!0===p&&2<=s&&c.find(".redux-repeater-accordion").accordion("option",{active:!1}),1<s&&redux.field_objects.repeater.remove(r)))})},redux.field_objects.repeater.remove=function(t){t.find(".redux-repeaters-remove").on("click",function(){var e,r;redux_change(l(this)),e=l(this).parents(".redux-container-repeater:first"),r=e.attr("data-id"),u.repeater[r].blank=l(this).parents(".redux-repeater-accordion-repeater:first").clone(!0,!0),l(this).parents(".redux-repeater-accordion-repeater:first").slideUp("medium",function(){l(this).remove(),redux.field_objects.repeater.sort_repeaters(t),""!==u.repeater[r].limit&&e.find(".redux-repeater-accordion-repeater").length<u.repeater[r].limit&&e.find(".redux-repeaters-add").removeClass("button-disabled"),e.find(".redux-repeater-accordion-repeater:last .ui-accordion-header").trigger("click")})}),t.find(".redux-repeater-accordion-repeater").hasClass("close-me")&&t.find(".redux-repeaters-remove").trigger("click")},redux.field_objects.repeater.bindTitle=function(e){e.find(".redux-repeater-accordion-repeater .bind_title").on("change keyup",function(e){e=0<l(e.target).find(":selected").text().length?l(e.target).find(":selected").text():l(e.target).val();l(this).closest(".redux-repeater-accordion-repeater").find(".redux-repeater-header").text(e)})},redux.field_objects.repeater.setAccordion=function(i,e){var r=i.find(".redux-repeater-accordion"),r=!0===(p=Boolean(r.data("panels-closed")))?Boolean(!1):0,r=i.find(".redux-repeater-accordion").accordion({header:"> div > fieldset > h3",collapsible:!0,active:r,beforeActivate:function(e){var r=l(this).next(".redux-repeaters-add").attr("data-name"),t=r.indexOf("["),r=r.substring(0,t);"function"==typeof reduxRepeaterAccordionBeforeActivate&&reduxRepeaterAccordionBeforeActivate(l(this),i,e,r)},activate:function(e,r){var t,a;l.redux.initFields(),"function"==typeof reduxRepeaterAccordionActivate&&(a=(t=l(this).next(".redux-repeaters-add").attr("data-name")).indexOf("["),t=t.substring(0,a),reduxRepeaterAccordionActivate(l(this),i,e,r,t))},heightStyle:"content",icons:{header:"ui-icon-plus",activeHeader:"ui-icon-minus"}});!0===u.repeater[e].sortable?r.sortable({axis:"y",handle:"h3",placeholder:"ui-state-highlight",start:function(e,r){r.placeholder.height(r.item.height()),r.placeholder.width(r.item.width())},stop:function(e,r){r.item.children("h3").triggerHandler("focusout"),redux.field_objects.repeater.sort_repeaters(l(this))}}):r.find("h3.ui-accordion-header").css("cursor","pointer")},redux.field_objects.repeater.sort_repeaters=function(e){(e=e.hasClass("redux-container-repeater")?e:e.parents(".redux-container-repeater:first")).find(".redux-repeater-accordion-repeater").each(function(e){var r,t=l(this).attr("data-sortid"),a=l(this).find(".redux-field .repeater[name*='["+t+"]']");a.each(function(){l(this).attr("name",l(this).attr("name").replace("["+t+"]","["+e+"]"))}),(a=l(this).find(".slide-title")).attr("name",a.attr("name").replace("["+t+"]","["+e+"]")),a.attr("data-key",e),l(this).attr("data-sortid",e),r=(a=l(this).find(".ui-accordion-header")).attr("id").split("-header-"),a.attr("id",r[0]+"-header-"+e),r=a.attr("aria-controls").split("-panel-"),a.attr("aria-controls",r[0]+"-panel-"+e),r=(a=l(this).find(".ui-accordion-content")).attr("id").split("-panel-"),a.attr("id",r[0]+"-panel-"+e),r=a.attr("aria-labelledby").split("-header-"),a.attr("aria-labelledby",r[0]+"-header-"+e)})},redux.field_objects.repeater.check_parents_dependencies=function(a){var i="",e=a,r=e.lastIndexOf("-"),d=e.substring(r+1),r=e.replace(d,"99999");return u.required_child.hasOwnProperty(r)?l.each(u.required_child[r],function(e,r){var t;return(t=l("#"+u.args.opt_name+"-"+r.parent+"-"+d)).hasClass("hide")?i=!1:!1!==i?(null!==(t=t.serializeForm())&&"object"==typeof t&&t.hasOwnProperty(u.args.opt_name)&&(t=(void 0===t[u.args.opt_name][r.parent]?Object.values(t[u.args.opt_name])[0]:t[u.args.opt_name])[r.parent][d]),t=t=l("#"+u.args.opt_name+"-"+a).hasClass("redux-container-media")?t.url:t,i=l.redux.check_dependencies_visibility(t,r),!1):void 0}):i=!0,i},redux_hook(l.redux,"required",function(){var a=redux.field_objects.repeater.getOptName(l(".redux-container-repeater"));l.each(a.folds,function(e,r){var t;-1!==e.indexOf("-99999")&&(e=e.replace("-99999","")),(t=l("[id^="+a.args.opt_name+"-"+e+"]")).find("*").hasClass("in-repeater")&&(t.addClass("fold"),"hide"===r)&&(t.addClass("hide"),t.prevUntil("fieldset").addClass("hide"),t.hasClass("redux-container-section")&&(r=l("#section-"+e)).hasClass("redux-section-indent-start")&&(l("#section-table-"+e).hide().addClass("hide"),r.hide().addClass("hide")),t.hasClass("redux-container-info")&&l("#info-"+e).hide().addClass("hide"),t.hasClass("redux-container-divide")&&l("#divide-"+e).hide().addClass("hide"),t.hasClass("redux-container-raw"))&&t.parents().find("table#"+redux.args.opt_name+"-"+e).hide().addClass("hide")})}),redux_hook(l.redux,"check_dependencies",function(e,r,t){var a,i,d,n;l(t).hasClass("in-repeater")&&(a=(t=l(t)).parents(".redux-field:first").data("id"),t=t.parents(".redux-field-container:first"),i=t.hasClass("hide"),t=a.lastIndexOf("-"),d=a.substring(0,t),n=a.substring(t+1),l.each(u.required[d],function(e){var r,t,a;-1!==e.indexOf("99999")&&(e=e.replace("99999",n)),r=l(this),t=!1,a=l("#"+u.args.opt_name+"-"+e),!0===(t=i?t:redux.field_objects.repeater.check_parents_dependencies(e))?a.fadeIn(300,function(){l(this).removeClass("hide"),l(this).prevUntil("fieldset").removeClass("hide"),u.required.hasOwnProperty(e)&&l.redux.check_dependencies(l("#"+u.args.opt_name+"-"+e).children().first()),l.redux.initFields()}):a.fadeOut(100,function(){l(this).addClass("hide"),l(this).prevUntil("fieldset").addClass("hide"),u.required.hasOwnProperty(e)&&l.redux.required_recursive_hide(e)}),r.find("select, radio, input[type=checkbox]").trigger("change")}))})}(jQuery);